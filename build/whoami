KELPv1
E@deps
13
../tools//liblua.so@sourcemap
1B
main=./coreutils/whoami.luamain
29A
local function write(fd, data)
    local err = syscall("write", fd, data)
    return err == nil, err
end

local function exit(status)
    -- WILL NEVER RETURN IF IT WORKED
    local err = syscall("exit", status)
    return err == nil, err
end

local function uinfo(user)
    local err, x = syscall("uinfo", user)
    return x, err
end

local function pinfo(pid)
    local err, info = syscall("pinfo", pid)
    return info, err
end

local function main(_)
    write(0, assert(uinfo(assert(pinfo()).uid)).name .. "\n");
end

local ok, err = xpcall(main, debug.traceback, arg);
if not ok then
    write(2, err .. "\n");
    assert(exit(1));
end
assert(exit(err or 0));
